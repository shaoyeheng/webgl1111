
<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8>
    <meta name='viewport' content='width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover'/>
    <title>仟域全真实景三维服务平台</title>
<style>
body {
  font-family: Helvetica, "Helvetica Neue", sans-serif;
  font-size: 18px;
  background: #FFF;
  padding: 0;
  margin: 0;
  text-align: center;
}

#error {
  display: none;
  position: fixed;
  top: 20px; left: 20px; right: 20px; bottom: 20px;
  background: #444;
  padding: 8px;
  white-space: pre;
  color: #fff;
  font-family: monospace;
  font-weight: bold;
}

#Loading {
  position: absolute;
  top: 12px;
  left: 90px;
}

#Loading h4 {
  margin: 0px;
}

#loading-container {
  width: 150px;
  height: 150px;
  padding: 0px;
  margin: 0 0 0 0;
  position: absolute;
  top: 40%;
  left: 45%;
}

.loading-bgbox {
  position: absolute;
  width: 65px;
  height: 65px;
  background-color: #DDD;
  width: 65px;
  height: 65px;
}

#topleft {
  top: 5px;
  left: 5px;
}

#bottomleft {
  bottom: 5px;
  left: 5px;
}

#topright {
  top: 5px;
  right: 5px;
}

#bottomright {
  bottom: 5px;
  right: 5px;
}

#loading-indicator {
  position: absolute;
  top: 5px;
  left: 5px;
  width: 65px;
  height: 65px;
  background-color: #999;
  animation-name: indicator;
  animation-duration: 5s;
  animation-iteration-count: infinite;
}

@keyframes indicator {
  0%   {top: 5px; left: 5px; }
  25%  {top: 5px; left: 80px; }
  50%  {top: 80px; left: 80px; }
  75%  {top: 80px; left: 5px; }
}

#viewspacecontainer {
  position: relative;
  text-align: center;
  display: none;
  border: 3px solid #000;
}

/* The main MERF view */
.view {
  margin: auto;
  overflow: hidden;
  transform-origin: top left;
  background: #000;
  /* width: 100vw; */
  /* width: 100vh; */
}
</style>

<link type="text/css" href="css/lrtk.css" rel="stylesheet" />

<link type="text/css" href="css/scene-list.css" rel="stylesheet" />

<script src="https://s3.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"></script>

<script src="lrtk.js"></script>

</head>
<body style="overflow:hidden">

  <div id="black-div" style="width: 100vw;height:100vh;z-index: 999;position: absolute;left:0px;top:0px;background-color: #000;"></div>

<div id=error></div>

<div id="viewspacecontainer">
  <div id="Loading">
    <h4>
    <span id="image-progress">Loading images: 0/?</span>
    </h4>
  </div>
  <div id="loading-container" style="z-index: 1000;">
    <!-- <div id="topleft" class="loading-bgbox"></div>
    <div id="bottomleft" class="loading-bgbox"></div>
    <div id="topright" class="loading-bgbox"></div>
    <div id="bottomright" class="loading-bgbox"></div>
    <div id="loading-indicator"></div> -->
    <img src="./../../img/loading.gif" style="width: 177px;height: 80px;"/>
    <div id="loading-percentage-text" style="color: #fff;font-size: 16px;font-weight: 600;padding-left: 20px;">正在加载中....</div>
  </div>
  <div>
    <div class=viewspace id="viewspace"></div>
    <div style="z-index: 99;position: absolute;right: 25px;top: 10px;"> 
      <img src="./../../img/1.png" style="width: 60px;height: 60px;position: relative;right: -80px;top: 10px;">
      <img src="./../../img/2.png" class="imgbtn" onmousedown="btnControls('w')" onmouseup="btnControls()" style="width: 22px;height: 12px;position: relative;right: -35px;top: -10px;">
      <img src="./../../img/4.png" class="imgbtn" onmousedown="btnControls('s')" onmouseup="btnControls()" style="width: 22px;height: 12px;position: relative;right: -10px;top: 30px;">
      <img src="./../../img/6.png" class="imgbtn" onmousedown="btnControls('d')" onmouseup="btnControls()" style="width: 12px;height: 22px;position: relative;right: -10px;top: 10px;">
      <img src="./../../img/7.png" class="imgbtn" onmousedown="btnControls('a')" onmouseup="btnControls()" style="width: 12px;height: 22px;position: relative;right: 50px;top: 10px;">
    </div>
    <div style="z-index: 99;position: absolute;right: 25px;top: 100px;"> 
      <img src="./../../img/3.png" class="imgbtn" onmousedown="btnControls('r')" onmouseup="btnControls()" style="width: 26px;height: 26px;position: relative;right: -10px;top: 0px;">
      <img src="./../../img/5.png" class="imgbtn" onmousedown="btnControls('f')" onmouseup="btnControls()" style="width: 26px;height: 26px;position: relative;right: 19px;top: 37px;">
    </div>
    <div style="z-index: 99;position: absolute;right: 25px;top: 78px;"> 
      <!-- <img src="./../../img/8.png" class="imgbtn" onmousedown="FlyByUI('e', true)" onmouseup="FlyByUI('e', false)" style="width: 26px;height: 26px;position: relative;right: -34px;top: 39px;"> -->
      <!-- <img src="./../../img/9.png" class="imgbtn" onmousedown="FlyByUI('q', true)" onmouseup="FlyByUI('q', false)" style="width: 26px;height: 26px;position: relative;right: 44px;top: 39px;"> -->
    </div>
    <div style="z-index: 99;position: absolute;right: 27px;top: 188px;"> 
      <img src="./../../img/10.png" style="width: 76px;height: 76px;position: relative;right: -115px;top: 0px;">
      <img src="./../../img/11.png" class="imgbtn" onmousedown="btnControls('up')" onmouseup="btnControls()" style="width: 23px;height: 23px;position: relative;right: -62px;top: -27px;">
      <img src="./../../img/12.png" class="imgbtn" onmousedown="btnControls('do')" onmouseup="btnControls()" style="width: 23px;height: 23px;position: relative;right: -35px;top: 26px;">
      <img src="./../../img/14.png" class="imgbtn" onmousedown="btnControls('ri')" onmouseup="btnControls()" style="width: 23px;height: 23px;position: relative;right: -35px;top: 0px;">
      <img src="./../../img/13.png" class="imgbtn" onmousedown="btnControls('le')" onmouseup="btnControls()" style="width: 23px;height: 23px;position: relative;right: 45px;top: 0px;">
      <!-- <div id="joy1Div" style="width:110px;height:110px;"></div> -->
    </div>
    <!-- <div style="z-index: 99;position: absolute;right: 38px;top: 290px;"> 
      <img src="./images/map.png" title="重置视角" class="imgbtn" onclick="backPosition" style="width: 32px;height: 32px;">
    </div> -->

    <button id="closeRendererBtn" type="button" lay-on="close" class="layui-btn layui-btn-primary layui-btn-radius layui-btn-xs" style="display: none;background-color: #999;color: #fff; z-index: 99;position: absolute;left: 48vw;bottom: -35px;">&nbsp;&nbsp;关&nbsp;闭&nbsp;&nbsp;</button>
    <div id="btn-area1" style="z-index: 99;position: absolute;bottom: 10px;right: 15px;display: flex;flex-direction: column">
      <!-- <button id="open-scene-manage-btn" class="menubtn"><img src="./../../img/scene_manage.png" style="width: 17px;height:17px;padding-right: 5px;"/>场景管理</button> -->
      <button id="open-scene-btn" class="menubtn"><img src="./../../img/scene.png" style="width: 17px;height:17px;padding-right: 5px;"/>切换场景</button>
      <button id="open-roam-btn" class="menubtn"><img src="./../../img/roam.png" style="width: 20px;height:15px;padding-right: 5px;"/>开启漫游</button>
      <button id="open-record-btn" class="menubtn"><img src="./../../img/record.png" style="width: 20px;height:15px;padding-right: 5px;"/>漫游录制</button>
    </div>
    <div id="btn-area2" style="display: none;z-index: 99;position: absolute;bottom: 20px;right: 15px;">
      <button id="open-stop-roam-btn" class="menubtn layui-font-red" style="font-weight: 600;"><img src="./../../img/roam.png" style="width: 20px;height:15px;padding-right: 5px;"/>结束漫游</button>
    </div>
    <div style="text-align:left;z-index: 99;position: absolute;bottom: 30px;right: 120px;">
      <div id="record-div" style="display:none;padding: 5px;height: 480px;width:240px;background-color: rgba(0, 0, 0, 0.5);color: #FFF;border-radius: 8px;">
        <div style="font-size: 14px;padding:1px 1px 5px 1px;border-bottom: 1px solid skyblue;">
          <img src="./../../img/record.png" style="width: 20px;height:15px;padding-right: 5px;"/>漫游录制
        </div>
        <div style="margin-top: 5px;display: flex;justify-content:space-between;">
          <div>
            <div class="layui-font-blue" style="font-size: 11px;font-weight: 600;">
              路线名称:
            </div>
            <div class="layui-input-group" style="margin-top: 5px;">
              <input id="routeName" type="text" placeholder="请输入漫游路线名称" value="漫游路线" class="layui-input" style="width: 170px;height: 22px;font-size: 12px;">
            </div>
          </div>
          <div title="上传路线logo图片" id="ID-upload-logo-btn" style="margin: 8px 8px 3px 8px;border: 1px solid #eef1f1;padding: 0px;cursor: pointer;">
            <i class="layui-icon layui-icon-addition" style="font-size: 35px; color: #eef1f1;"></i>
          </div>
          <div title="上传路线logo图片" id="ID-upload-logo-btn2" style="width: 50px;cursor: pointer;display: none;margin-right: 5px;">
            <div class="layui-upload-list">
              <img class="layui-upload-img" id="ID-upload-logo-img" style="width: 100%; height: 40px;">
              <div id="ID-upload-logo-text"></div>
            </div>
            <!-- <div class="layui-progress layui-progress-big" lay-showPercent="yes" lay-filter="filter-logo">
              <div class="layui-progress-bar" lay-percent=""></div>
            </div> -->
          </div>
        </div>
        <div id="id-point-timeline" class="layui-timeline scrollbar6" style="padding: 8px 0px 0px 8px;height: 340px;overflow: auto;">
        </div>
        <div style="padding:10px;display: flex;justify-content:space-between;">
          <button id="addPointBtn" type="button" class="layui-btn layui-btn-normal layui-btn-sm" style="width: 140px;">新增标点</button>
          <button id="savePointBtn" type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="width: 140px;">保存录制</button>
        </div>
      </div>
      <div id="scene-div" style="display:none;padding: 5px;height: 400px;width:200px;background-color: rgba(0, 0, 0, 0.5);color: #FFF;border-radius: 8px;">
        <div style="font-size: 14px;padding:1px 1px 5px 1px;border-bottom: 1px solid skyblue;">
          <img src="./../../img/scene.png" style="width: 17px;height:17px;padding-right: 5px;"/>切换场景
        </div>
        <div id="scene-list-div">
        </div>
      </div>
    </div>
    <div style="text-align:left;z-index: 99;position: absolute;bottom: 120px;">
      <div id="roam-div" style="display:none;padding: 10px 5px 10px 5px;height: 120px;width:100%;background-color: rgba(0, 0, 0, 0.3);color: #FFF;border-radius: 8px;">
        <div class="box">
          <div class="picbox">
            <ul id="ul-piclist" class="piclist mainlist">
              
            </ul>
            <ul class="piclist swaplist"></ul>
          </div>
          <div class="og_prev"></div>
          <div class="og_next"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="./../../layui/css/layui.css">
<script src="./../../layui/layui.js"></script>

<style>
  .imgbtn:hover{
    cursor:pointer;
    filter: brightness(0.7);
  }
  .menubtn{
    background-color: rgba(0, 0, 0, 0.5);
    color: #FFF;
    padding: 7px 10px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    margin-bottom: 8px;
  }
  .menubtn-select{
    background-color: rgb(19, 207, 188);
  }

  .scrollbar6::-webkit-scrollbar {
      width: 6px;
  }
  .scrollbar6::-webkit-scrollbar-track {
      border-radius: 8px;
      background-color: #60636d;
      border: 1px solid #7e7f82;
  }
  .scrollbar6::-webkit-scrollbar-thumb {
      border-radius: 8px;
      background-color: #1a84d0;
  }
</style>

<script>
  // const httpUrl = '/livescene';
  const httpUrl = 'http://192.168.21.200:9102/';
  let pointArr = [];
  let logoUrl = ''

  layui.use(function(){
    var util = layui.util;
    var upload = layui.upload;
    var element = layui.element;

    // 事件
    util.on('lay-on', {
      close:function(){
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
      }
    })

    var uploadInst = upload.render({
      elem: '#ID-upload-logo-btn',
      url: httpUrl+'/route/upload', 
      before: function(obj){
        // 预读本地文件示例，不支持ie8
        obj.preview(function(index, file, result){
          $('#ID-upload-logo-img').attr('src', result); // 图片链接（base64）
        });
        
        element.progress('filter-logo', '0%'); // 进度条复位
        layer.msg('上传中', {icon: 16, time: 0});
      },
      done: function(res){
        // 若上传失败
        if(res.code != 200){
          return layer.msg('上传失败');
        }

        $("#ID-upload-logo-btn").hide()
        $("#ID-upload-logo-btn2").show()

        logoUrl = res.data

        // 上传成功的一些操作
        // …
        $('#ID-upload-logo-text').html(''); // 置空上传失败的状态
      },
      error: function(){

      },
      // 进度条
      progress: function(n, elem, e){
        element.progress('filter-logo', n + '%'); // 可配合 layui 进度条元素使用
        if(n == 100){
          layer.msg('上传完毕', {icon: 1,time: 1000});
        }
      }
    });

    upload.render({
      elem: '#ID-upload-logo-btn2',
      url: httpUrl+'/route/upload', // 此处用的是第三方的 http 请求演示，实际使用时改成您自己的上传接口即可。
      before: function(obj){
        // 预读本地文件示例，不支持ie8
        obj.preview(function(index, file, result){
          $('#ID-upload-logo-img').attr('src', result); // 图片链接（base64）
        });
        
        element.progress('filter-logo', '0%'); // 进度条复位
        layer.msg('上传中', {icon: 16, time: 0});
      },
      done: function(res){
        // 若上传失败
        if(res.code != 200){
          return layer.msg('上传失败');
        }

        $("#ID-upload-logo-btn").hide()
        $("#ID-upload-logo-btn2").show()

        // 上传成功的一些操作
        // …
        $('#ID-upload-logo-text').html(''); // 置空上传失败的状态
      },
      error: function(){

      },
      // 进度条
      progress: function(n, elem, e){
        element.progress('filter-logo', n + '%'); // 可配合 layui 进度条元素使用
        if(n == 100){
          layer.msg('上传完毕', {icon: 1,time: 1000});
        }
      }
    });
  })

  // var Joy1 =new JoyStick('joy1Div',{
  //   internalFillColor:'#989493',
  //   externalStrokeColor: '#989493'
  // });

  // var joyIndex = undefined;

  // function moveView(){
  //   joyIndex = setInterval(function(){console.log(Joy1.GetDir());},50)
  // }

  // function cancelView(){
  //   if(joyIndex){
  //     clearInterval(joyIndex)
  //   }
  // }


</script>

<script>
  function startRoam(data){
    preview(data)
  }

  const _this = this;

  let sceneList = [];

  $(document).ready(function(){
    // const list = Object.keys(localStorage)
    //     .filter((item) => /@roam/.test(item))
    //     .map((key) => ({ key, data: JSON.parse(localStorage[key]) }));

    // for (let i = list.length - 1; i >= 0; i--) {
    //   $("#roam-route-div").append("<div class='layui-panel' style='font-size:12px;color:#33ccff;padding:3px;margin-bottom:5px;display:flex;justify-content:space-between;'>" + `第 ${i + 1} 个路线： ${new Date(
    //     Number(list[i].key.replace(/.*@roam@/, ""))
    //   ).toLocaleString().substring(0,10)}`+" <i onclick='startRoam("+list[i].data+")' title='开始漫游' class='layui-icon layui-icon-release layui-font-red' style='font-size: 16px; color: #1E9FFF;cursor: pointer;padding-right:5px;'></i> </div>");
    // }

    if(parent.layer.index > 0){
      $("#closeRendererBtn").show();
    }

    $("#open-record-btn").on("click",function(){
      $('#roam-div').hide();
      $("#scene-div").hide()

      $('#record-div').animate({width: 'toggle'}, 'fast');
      if($('#open-record-btn').hasClass("menubtn-select")){
        $('#open-record-btn').removeClass("menubtn-select");
      }else{
        $('.menubtn').removeClass("menubtn-select");
        $('#open-record-btn').addClass("menubtn-select");
      }

      if(pointArr.length > 0){
        return;
      }

      let point = {
        pointName: '起始标点',
        positionX: gCamera.position.x,
        positionY: gCamera.position.y,
        positionZ: gCamera.position.z,
        rotationX: gCamera.rotation.x,
        rotationY: gCamera.rotation.y,
        rotationZ: gCamera.rotation.z,
      };

      pointArr.push(point);

      updatePointTimeline();
    });

    $("#open-roam-btn").on("click",function(){
      $('#record-div').hide();
      $("#scene-div").hide()

      $('#roam-div').animate({width: 'toggle'}, 'fast');
      if($('#open-roam-btn').hasClass("menubtn-select")){
        $('#open-roam-btn').removeClass("menubtn-select");
      }else{
        $('.menubtn').removeClass("menubtn-select");
        $('#open-roam-btn').addClass("menubtn-select");
      }

      let routeList = []
      $.get(httpUrl+"/route/list",function(data,status){
        let picHtml = ``
        
        routeList = data.rows;
        data.rows.forEach(item => {
          picHtml += `<li data-route-id=${item.roamRouteId} class="li-pic" style="cursor: pointer;">
              <img title="${item.routeName}" src="http://42.192.136.216/images/${item.logo}" width="220" height="105"/>
            </li>`
        });

        $("#ul-piclist").html(picHtml)

        initPic();

        $(".li-pic").on("click", function(event) {
          if(roam){
            return;
          }

          var routeId = event.currentTarget.dataset.routeId;
          routeList.forEach(item => {
            if(routeId == item.roamRouteId){

              let pointData = [];
              let pointList = item.pointList
              pointList.forEach(element => {
                pointData.push({
                  p:[element.positionX,element.positionY,element.positionZ],
                  r:[element.rotationX,element.rotationY,element.rotationZ,'XYZ'],
                })
              });

              gCamera.position.set(pointData[0].p[0], pointData[0].p[1], pointData[0].p[2])
              gCamera.rotation.set(pointData[0].r[0], pointData[0].r[1], pointData[0].r[2])

              roam = new Roam(pointData);

              $("#roam-div").hide()

              $("#btn-area1").hide()
              $("#btn-area2").show()
            }
          })
        });
      });
    });

    $("#open-stop-roam-btn").on("click", function(event) {
      roam.dispose();
      roam = null;

      $("#btn-area1").show()
      $("#btn-area2").hide()
      $('#open-roam-btn').removeClass("menubtn-select");

      layer.msg('漫游已结束',{time: 1000});
    })

    $("#open-scene-btn").on("click", function(event) {
      $('#roam-div').hide();
      $('#record-div').hide();

      if($('#open-scene-btn').hasClass("menubtn-select")){
        $('#open-scene-btn').removeClass("menubtn-select");
      }else{
        $('.menubtn').removeClass("menubtn-select");
        $('#open-scene-btn').addClass("menubtn-select");
      }

      $('#scene-div').animate({width: 'toggle'}, 'fast');
    })

    $("#open-scene-manage-btn").on("click", function(event) {
      $('#roam-div').hide();
      $('#record-div').hide();
      $('#scene-div').hide();

      if($('#open-scene-manage-btn').hasClass("menubtn-select")){
        $('#open-scene-manage-btn').removeClass("menubtn-select");
      }else{
        $('.menubtn').removeClass("menubtn-select");
        // $('#open-scene-manage-btn').addClass("menubtn-select");
      }

      layer.open({
        type: 2,
        title: '场景管理',
        shadeClose: true,
        shade: 0.8,
        area: ['1100px', '90%'],
        content: 'pages/sceneManage.html'
      });
    })

    $("#addPointBtn").on("click",function(){

      let point = {
        pointName: '起始标点',
        positionX: gCamera.position.x,
        positionY: gCamera.position.y,
        positionZ: gCamera.position.z,
        rotationX: gCamera.rotation.x,
        rotationY: gCamera.rotation.y,
        rotationZ: gCamera.rotation.z,
      };

      pointArr.push(point);

      console.log(point);

      updatePointTimeline();
    });

    function updatePointTimeline(){
      let pointHtml = '';
      pointArr.forEach((item,index) => {
        let pointName = '起始标点'
        let pointIcon = '<i class="layui-icon layui-timeline-axis layui-icon-play"></i>'

        if(index > 0){
          pointName = '中途标点' + index
          pointIcon = '<i class="layui-icon layui-timeline-axis layui-icon-radio"></i>'

          if(pointArr.length == (index+1)){
            pointName = '终止标点'
            pointIcon = '<i class="layui-icon layui-timeline-axis layui-icon-circle-dot"></i>'
          }
        }
        item.pointName = pointName

        pointHtml += `<div class="layui-timeline-item">
          ${pointIcon}
            <div class="layui-timeline-content layui-text">
              <div class="layui-timeline-title" style="font-size: 12px;display:flex;justify-content:space-between;">
                <span>${pointName}</span>
                <div class="layui-btn-group" style="margin-right:5px;">
                  <button type="button" data-point-index=${index} class="layui-btn layui-btn-radius layui-btn-xs point-track-btn">追踪</button>
                  <button type="button" data-point-index=${index} class="layui-btn layui-btn-radius layui-btn-warm layui-btn-xs point-delete-btn">删除</button>
                </div>
              </div>
            </div>
          </div>`;
      });
      $("#id-point-timeline").html(pointHtml);
      
      $(".point-track-btn").on("click", function(event) {
        var pointIndex = event.currentTarget.dataset.pointIndex;
        let position = [pointArr[pointIndex].positionX,pointArr[pointIndex].positionY,pointArr[pointIndex].positionZ]
        let rotation = [pointArr[pointIndex].rotationX,pointArr[pointIndex].rotationY,pointArr[pointIndex].rotationZ,"XYZ"]

        this.position = gCamera.position.clone();
        this.rotation = gCamera.rotation.clone();
        this.position.fromArray(position);
        this.rotation.fromArray(rotation);
        gCamera.position.copy(this.position.clone());
        gCamera.rotation.copy(this.rotation.clone());
      });

      $(".point-edit-btn").on("click", function(event) {
        var pointIndex = event.currentTarget.dataset.pointIndex;
        layer.open({
          type: 1,
          area: '350px',
          resize: false,
          shadeClose: true,
          title: '编辑标点坐标',
          content: `<form class="layui-form layui-form-pane" action="">
            <div class="layui-form-item" style="padding:5px;">
              <label class="layui-form-label">长输入框</label>
              <div class="layui-input-block">
                <input type="text" name="title" autocomplete="off" placeholder="请输入" lay-verify="required" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <button class="layui-btn" lay-submit lay-filter="demo2">保存</button>
              <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
          </form>`
        });
      });

      $(".point-delete-btn").on("click", function(event) {
        var pointIndex = event.currentTarget.dataset.pointIndex;
        pointArr.splice(pointIndex,1);
        updatePointTimeline(pointArr);
      });
    }

    $("#savePointBtn").on("click",function(){
      if(pointArr.length < 2){
        layer.msg('漫游路线至少需要两个标点！', {icon: 2,time: 2000});
        return;
      }

      $.ajax({
        method: "POST",
        url: httpUrl+'/route',
        contentType: 'application/json',
        data:JSON.stringify({
          routeName: $("#routeName").val(),
          logo: logoUrl,
          pointList: pointArr
        }),
        success: function( data ) {
          layer.msg('保存成功', {icon: 1,time: 1000});
          pointArr = []
          $('#record-div').hide();
          $('#open-record-btn').removeClass("menubtn-select");
        }
      });
    });

    getSceneList();

  });

  function getSceneList(){
    $.get(httpUrl+"/scene/list",function(data,status){
      sceneList = data;
      initPosition();
      start();

      let html = `<section class="hero-section"><div class="card-grid scrollbar6" style="height: 360px;padding: 5px 0px;overflow-y: auto;overflow-x: hidden;">`;
      data.forEach((item,index) => {
        html += `<a class="card" href="#">
                <div data-scene-index=${index} class="card__background" style="background-image: url(http://42.192.136.216/images/${item.logo})"></div>
                <div class="card__content">
                  <p class="card__category">${item.sceneName}</p>
                </div>
              </a>`
      });

      html += `</div></section>`

      $("#scene-list-div").html(html);

      $(".card__background").on("click", function(event) {
        var sceneIndex = event.currentTarget.dataset.sceneIndex;
        let sceneObj = data[sceneIndex];

        clearScene();
        window.location.href = window.location.href.split('?')[0] + '?dir=' + sceneObj.resourcePath;
      });
    });
  }

  function initPosition(){
    sceneList.forEach(item => {
      if('dir='+item.resourcePath == window.location.href.split('?')[1]){

        CONFIG.cameraOptions.default = {
          position: [item.positionX,item.positionY,item.positionZ],
          rotation: [item.rotationX,item.rotationY,item.rotationZ,"XYZ"]
        }
      }
    });
  }

  function backPosition(){
    let position = [-0.10462288529115646, -0.007084388584290962, 0.003724369367013562]
    let rotation = [-1.7362318168992519, -1.0590688652209677, -1.7507624493818552, 'XYZ']

    this.position = gCamera.position.clone();
    this.rotation = gCamera.rotation.clone();
    this.position.fromArray(position);
    this.rotation.fromArray(rotation);
    gCamera.position.copy(this.position.clone());
    gCamera.rotation.copy(this.rotation.clone());
  }

  function btnControls(key){
    gOrbitControls.btnControls(key);
  }
</script>

<!-- third party -->
<script src="third_party/three.js"></script>
<script src="third_party/OrbitControls.js"></script>
<script src="third_party/PointerLockControls.js"></script>
<script src="third_party/FlyControls.js"></script>
<script src="third_party/zlib.js"></script>
<script src="third_party/png.js"></script>
<script src="third_party/stats.min.js"></script>
<script src="third_party/lil-gui.18.js"></script>

<!-- own code-->
<script src="CONFIG.js"></script>
<script src="progressive.js"></script>
<script src="viewdependency.js"></script>
<script src="defaultposes.js"></script>
<script src="input.js"></script>
<script src="pathEditor.js"></script>
<script src="index.js"></script>
</body>
</html>
